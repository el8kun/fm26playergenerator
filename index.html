// gestion des tabs
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const target = tab.dataset.tab;
    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
    document.getElementById(target).style.display = 'block';
  });
});

// ---------------------------------------------
// FONCTIONS UTILES FM26
// ---------------------------------------------
function randInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function clampFM(v) {
  return Math.max(5, Math.min(15, Math.round(v)));
}

// Limite à 3 notes à 15
function enforceMax15(attrs) {
  let count15 = 0;
  for (const k in attrs) {
    if (attrs[k] === 15) count15++;
  }

  if (count15 <= 3) return attrs;

  // Si trop de notes à 15 → on réduit aléatoirement
  let keys = Object.keys(attrs).filter(k => attrs[k] === 15);
  while (count15 > 3) {
    let remove = keys.pop();
    attrs[remove] = 14;
    count15--;
  }
  return attrs;
}

// ---------------------------------------------
// PROFILS & POSTES : MOYENNES DE BASE FM
// ---------------------------------------------
const BASE_PROFILES = {
  "Équilibré": 10,
  "Offensif": 11,
  "Défensif": 10,
  "Physique": 11,
  "Rapide": 12,
  "Technique": 12
};

const POSITION_BONUS = {
  "Buteur (BU)": { "Finition": 2, "Sang-froid": 1 },
  "Ailier (AD/AG)": { "Vitesse": 2, "Accélération": 1 },
  "Milieu offensif (MOC)": { "Technique": 2, "Passes": 1 },
  "Milieu central (MC)": { "Passes": 1, "Décisions": 1 },
  "Défenseur central (DC)": { "Tacles": 2, "Placement": 1 },
  "Latéral (DG/DR)": { "Vitesse": 1, "Tacles": 1 },
  "Gardien (GB)": { "Placement": 1 }
};

// ---------------------------------------------
// GÉNÉRATION DU PROFIL FM26
// ---------------------------------------------
document.getElementById("generate").addEventListener("click", () => {

  let name = document.getElementById("name").value;
  let nat = document.getElementById("nation").value;
  let age = parseInt(document.getElementById("age").value);
  let pos = document.getElementById("position").value;
  let prof = document.getElementById("profile").value;
  let random = parseInt(document.getElementById("randomness").value);

  // Moyenne de base selon profil
  let base = BASE_PROFILES[prof];

  let attrs = {
    "Finition": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Finition || 0)),
    "Vitesse": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Vitesse || 0)),
    "Accélération": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Accélération || 0)),
    "Tacles": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Tacles || 0)),
    "Passes": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Passes || 0)),
    "Technique": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Technique || 0)),
    "Décisions": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Décisions || 0)),
    "Placement": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.Placement || 0)),
    "Sang-froid": clampFM(base + randInt(-3, 3) + (POSITION_BONUS[pos]?.SangFroid || 0))
  };

  // Limitation FM : max 3 attributs à 15
  attrs = enforceMax15(attrs);

  // Potentiel FM (entre 130 et 200)
  const potentiel = randInt(130, 200);

  // Affichage
  let txt = `Nom : ${name}
Nationalité : ${nat}
Âge : ${age}
Poste : ${pos}
Profil : ${prof}

Potentiel : ${potentiel} / 200

Attributs :
`;

  for (const a in attrs) txt += `${a} : ${attrs[a]}\n`;

  document.getElementById("output").textContent = txt;
});

// COPIE
document.getElementById("copy").addEventListener("click", () => {
  navigator.clipboard.writeText(document.getElementById("output").textContent);
  alert("Copié !");
});
